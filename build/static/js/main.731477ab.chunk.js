(this["webpackJsonpmonday-integration-quickstart-app"]=this["webpackJsonpmonday-integration-quickstart-app"]||[]).push([[0],{36:function(e,t,a){e.exports=a(85)},41:function(e,t,a){},42:function(e,t,a){},85:function(e,t,a){"use strict";a.r(t);var s=a(0),o=a.n(s),n=a(17),r=a.n(n),i=(a(41),a(2)),l=a(3),c=a(1),p=a(5),d=a(4),u=(a(42),a(8)),h=a.n(u),m=a(10),f=a.n(m),g=a(11),_=a.n(g),w=a(33),k=a.n(w),j=a(34),v=a.n(j)()(),b={default:{text:"Something went wrong, please check the logs",explanation:""},unauthorized:{text:"You are unauthorized. Please enter a valid CircleCI API token.",explanation:'Go to CircleCI and log in. Then click on your profile on the bottom left and go to "Personal API Tokens". Create a new API Token and enter it here at "CircleCI API token" in the settings.'},bad_request:{text:"Error 400: Bad request",explanation:""},no_org_slug:{text:"Please enter your VCS provider. This can be GitHub or BitBucket",explanation:""},form_not_filled:{text:"Please fill in all fields",explanation:"Fill in all required fields to get started with this widget."},no_results:{text:"The server returned no results.",explanation:"Did you fill in all values correctly? A possible reason for this error could be that you entered the wrong VCS provider."},workflow_not_found:{text:"This workflow could not be found. Please check the name.",explanation:""},project_not_found:{text:"This project could not be found. Please check the name.",explanation:""}},E={"You must log in first.":"You are unauthorized. Please enter a valid CircleCI API token.","Organization not found":"Organization not found. Please check your organization name."},y=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(e){var s;return Object(i.a)(this,a),(s=t.call(this,e)).state={settings:{},name:"",expected_results:0,fetched_results:0,errorMessageEnabled:!1,errorMessage:"",errorExplanation:"",welcomeMessageEnabled:!1,projects:{},project_name:"",workflow_name:"",errorFlipped:!1,theme:"light",edit_mode:!1,loading:!0},s.flipCard=s.flipCard.bind(Object(c.a)(s)),s.selectProject=s.selectProject.bind(Object(c.a)(s)),s.saveSelectedProject=s.saveSelectedProject.bind(Object(c.a)(s)),s.selectWorkflow=s.selectWorkflow.bind(Object(c.a)(s)),s.saveSelectedWorkflow=s.saveSelectedWorkflow.bind(Object(c.a)(s)),s.stopLoading=s.stopLoading.bind(Object(c.a)(s)),s.displayMessage=s.displayMessage.bind(Object(c.a)(s)),s}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;v.listen("settings",(function(t){e.setState({settings:t.data,loading:!0})})),this.interval=setInterval((function(){"light"===e.state.theme?e.setState({theme:"dark"}):e.setState({theme:"light"})}),3e3)}},{key:"flipCard",value:function(e){e.preventDefault(),this.setState((function(e){return{errorFlipped:!e.errorFlipped}}))}},{key:"selectProject",value:function(e){this.state.selectedProject!==e?this.setState({selectedProject:e}):this.setState({selectedProject:""})}},{key:"saveSelectedProject",value:function(e){this.setState({saveSelectedProject:e})}},{key:"selectWorkflow",value:function(e){this.state.selectedWorkflow!==e?this.setState({selectedWorkflow:e}):this.setState({selectedWorkflow:""})}},{key:"saveSelectedWorkflow",value:function(e){this.setState({saveSelectedWorkflow:e})}},{key:"displayMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"welcome"===t?this.setState({welcomeMessageEnabled:e}):a?this.setState({errorMessageEnabled:e,errorMessage:b[t].text,errorExplanation:b[t].explanation}):this.setState({errorMessageEnabled:e,errorMessage:t,errorExplanation:""}),e||this.setState({errorFlipped:!1,welcomeMessageEnabled:e})}},{key:"stopLoading",value:function(){this.setState({loading:!1})}},{key:"settingsComplete",value:function(){return null!==this.state.settings.vcs_provider&&0!==this.state.settings.organization_name.length}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.state.expected_results===t.expected_results&&this.state.fetched_results===t.fetched_results||this.state.expected_results!==this.state.fetched_results||this.stopLoading(),t.settings!==this.state.settings&&(this.settingsComplete()?fetch("https://circleci.com/api/v2/pipeline?circle-token="+this.state.settings.circleci_api_token+"&org-slug="+this.state.settings.vcs_provider+"/"+this.state.settings.organization_name,{headers:{Accept:"application/json"}}).then((function(e){return 401===e.status&&a.displayMessage(!0,"unauthorized"),e.json()})).then((function(e){if(e.message in E)a.displayMessage(!0,E[e.message],!1);else if(e.items.length>0){var t=e.items;for(var s in a.setState({expected_results:t.length,projects:[]}),t)a.getWorkflow(t[s]);a.displayMessage(!1)}else a.displayMessage(!0,"no_results"),a.state.errorFlipped||setTimeout((function(){a.setState({errorFlipped:!0})}),3e3)})).catch(console.log):this.displayMessage(!0,"welcome"))}},{key:"getWorkflow",value:function(e){var t=this;fetch("https://circleci.com/api/v2/pipeline/"+e.id+"/workflow?circle-token="+this.state.settings.circleci_api_token+"&org-slug="+this.state.settings.vcs_provider+"/"+this.state.settings.organization_name,{headers:{Accept:"application/json"}}).then((function(e){return e.json()})).then((function(a){var s=t.state.projects;for(var o in s[e.project_slug]||(s[e.project_slug]=[]),a.items)s[e.project_slug].push(a.items[o]);t.setState({projects:s,fetched_results:t.state.fetched_results+1})})).catch(console.log)}},{key:"render",value:function(){return this.state.welcomeMessageEnabled?o.a.createElement("div",{className:"App"},o.a.createElement(C,{theme:this.state.theme})):this.state.errorMessageEnabled?o.a.createElement("div",{className:"App"},o.a.createElement(O,{message:this.state.errorMessage,explanation:this.state.errorExplanation,errorFlipped:this.state.errorFlipped,flipCard:this.flipCard,theme:this.state.theme})):o.a.createElement("div",{className:"app"},o.a.createElement(S,{settings:this.state.settings,project_name:this.state.project_name,workflow_name:this.state.workflow_name,projects:this.state.projects,theme:this.state.theme,edit_mode:this.state.edit_mode,loading:this.state.loading,stopLoading:this.stopLoading}))}}]),a}(o.a.Component),C=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(f.a,{className:"dark"===this.props.theme?"dark_mode":"",options:{max:20}},o.a.createElement("div",{className:"welcome_message_wrapper"},o.a.createElement("p",{className:"welcome_title"},"CircleCI widget"),o.a.createElement("img",{className:"circleci_logo",src:"/circleci_logo"+("dark"===this.props.theme?"_dark":"")+".png"}),o.a.createElement("img",{className:"circleci_logo_second logo_animation",src:"/circleci_logo"+("dark"===this.props.theme?"_dark":"")+".png"}),o.a.createElement("p",{className:"welcome_text"},"Fill in all fields to get started")))}}]),a}(o.a.Component),O=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(f.a,{className:"Tilt-error "+("dark"===this.props.theme?"dark_mode":""),options:{max:20}},o.a.createElement(k.a,{isFlipped:this.props.errorFlipped&&this.props.explanation.length>0},o.a.createElement("div",{onClick:this.props.flipCard,className:"error_message_wrapper"},o.a.createElement("p",{className:"error_message_title"},"Error"),o.a.createElement("p",{className:"error_message_message"},this.props.message),o.a.createElement("img",{alt:"Error",className:"error_message_exclamation_mark",src:"/exclamation_mark.png"})),o.a.createElement("div",{onClick:this.props.flipCard,className:"error_message_wrapper"},o.a.createElement("p",{className:"error_explanation"},this.props.explanation))))}}]),a}(o.a.Component),S=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(e){var s;return Object(i.a)(this,a),(s=t.call(this,e)).state={status:"",configEnabled:!1,configType:"",workflows:[],project_name:"",workflow_name:""},s.get_workflows=s.get_workflows.bind(Object(c.a)(s)),s.displayConfig=s.displayConfig.bind(Object(c.a)(s)),s.setProject=s.setProject.bind(Object(c.a)(s)),s.setWorkflow=s.setWorkflow.bind(Object(c.a)(s)),s.getStatus=s.getStatus.bind(Object(c.a)(s)),s}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(e,t){this.getStatus(e,t),this.state.project_name!==t.project_name&&v.storage.instance.setItem("project_name",this.state.project_name),this.state.workflow_name!==t.workflow_name&&v.storage.instance.setItem("workflow_name",this.state.workflow_name),""!==this.state.project_name&&Object.keys(this.props.projects).length>0&&this.state.workflows===t.workflows&&this.get_workflows()}},{key:"get_workflows",value:function(){try{var e=[],t=[],a=this.props.projects[this.state.project_name],s=Object.keys(a);for(var o in s)t.includes(a[o].name)||(e.push(a[o]),t.push(a[o].name));this.setState({workflows:e})}catch(n){}}},{key:"componentDidMount",value:function(){var e=this;v.storage.instance.getItem("project_name").then((function(t){null!==t.data.value&&e.setState({project_name:t.data.value})})),v.storage.instance.getItem("workflow_name").then((function(t){null!==t.data.value&&e.setState({workflow_name:t.data.value})}))}},{key:"displayConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.setState({configEnabled:e,configType:t}),"project"===t?this.setState({project_name:""}):"workflow"===t&&this.setState({workflow_name:""})}},{key:"setProject",value:function(e){this.setState({project_name:e})}},{key:"setWorkflow",value:function(e){this.setState({workflow_name:e})}},{key:"getStatus",value:function(e,t){var a=this,s=this.props.projects[this.state.project_name];if(void 0===s||""===this.state.project_name)this.state.configEnabled||"project"===this.state.configType||this.displayConfig(!0,"project");else{var o=s.find((function(e){return e.name===a.state.workflow_name}));void 0===o?this.state.configEnabled&&"workflow"===this.state.configType||(this.displayConfig(!0,"workflow"),v.storage.instance.getItem("workflow_name").then((function(e){null!==e.data.value&&e.data.value!==a.state.workflow_name&&a.setState({workflow_name:e.data.value})}))):(this.state.configEnabled&&this.displayConfig(!1),void 0!==o&&this.state.status!==o.status&&(this.setState({status:o.status}),this.props.loading&&this.props.stopLoading()))}}},{key:"render",value:function(){var e=this;return this.props.loading?o.a.createElement("div",{className:"App"},o.a.createElement(P,{project:this.state.project_name,workflow:this.state.workflow_name,status:this.state.status,theme:this.props.theme,edit_mode:this.props.edit_mode,edit_project:function(){return e.displayConfig(!0,"project")},edit_workflow:function(){return e.displayConfig(!0,"workflow")},loading:this.props.loading})):this.state.configEnabled&&"project"===this.state.configType?o.a.createElement("div",{className:"App"},o.a.createElement(x,{projects:this.props.projects,setProject:this.setProject,project_name:this.state.project_name,displayConfig:this.displayConfig})):this.state.configEnabled&&"workflow"===this.state.configType?o.a.createElement("div",{className:"App"},o.a.createElement(N,{workflows:this.state.workflows,setWorkflow:this.setWorkflow,workflow_name:this.state.workflow_name,displayConfig:this.displayConfig})):(this.props.loading,o.a.createElement("div",{className:"App"},o.a.createElement(P,{project:this.state.project_name,workflow:this.state.workflow_name,status:this.state.status,theme:this.props.theme,edit_mode:this.props.edit_mode,edit_project:function(){return e.displayConfig(!0,"project")},edit_workflow:function(){return e.displayConfig(!0,"workflow")},loading:this.props.loading})))}}]),a}(o.a.Component),x=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("p",{className:""},"Select your project"),o.a.createElement("div",{className:"project_wrapper"},Object.keys(this.props.projects).map((function(t){return o.a.createElement("div",{className:"project_block",onClick:function(){return e.props.setProject(t.toString())}},o.a.createElement("p",null,t.toString().split("/").pop()))}))))}}]),a}(o.a.Component),N=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("p",{className:""},"Select your workflow"),o.a.createElement("div",{className:"project_wrapper"},this.props.workflows.map((function(t){return o.a.createElement("div",{className:"project_block",onClick:function(){return e.props.setWorkflow(t.name)}},o.a.createElement("p",null,t.name))}))))}}]),a}(o.a.Component),P=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return console.log(this.props.loading),this.props.loading?o.a.createElement("div",{className:"dark"===this.props.theme?"dark_mode":""},o.a.createElement(f.a,{className:"Tilt Tilt_status",options:{max:25},onMouseLeave:this.onMouseLeave},o.a.createElement(g.SkeletonTheme,{color:"dark"===this.props.theme?"#444":"",highlightColor:"dark"===this.props.theme?"#555":""},o.a.createElement("p",{className:"status_badge_title"},o.a.createElement(_.a,null)),o.a.createElement("p",{className:"status_badge_subtitle"},o.a.createElement(_.a,null)),o.a.createElement(_.a,{width:100,className:"Tilt-inner status_badge_wrapper"})))):o.a.createElement("div",{className:"dark"===this.props.theme?"dark_mode":""},o.a.createElement(f.a,{className:"Tilt Tilt_status",options:{max:25},onMouseLeave:this.onMouseLeave},o.a.createElement("p",{className:"status_badge_title"},this.props.project.split("/").pop()," ",this.props.edit_mode?o.a.createElement(h.a,{icon:"edit",color:"#000",onClick:this.props.edit_project}):""),o.a.createElement("p",{className:"status_badge_subtitle"},this.props.workflow," ",this.props.edit_mode?o.a.createElement(h.a,{icon:"edit",color:"#000",onClick:this.props.edit_workflow}):""),o.a.createElement("div",{className:"Tilt-inner status_badge_wrapper status_"+this.props.status},o.a.createElement("div",{className:"status_badge_icon"},o.a.createElement(M,{status:this.props.status})),o.a.createElement("p",{className:"status_badge_text"},this.props.status))))}}]),a}(o.a.Component),M=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return"canceled"===this.props.status?o.a.createElement(h.a,{icon:"remove_circle_outline",color:"#FFF"}):"failed"===this.props.status?o.a.createElement(h.a,{icon:"error_outline",color:"#FFF"}):"success"===this.props.status?o.a.createElement(h.a,{icon:"check_circle_outline",color:"#FFF"}):null}}]),a}(o.a.Component),T=y;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[36,1,2]]]);
//# sourceMappingURL=main.731477ab.chunk.js.map